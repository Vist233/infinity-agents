import os
from openai import OpenAI
import base64
import json
import csv


DASHSCOPE_API_KEY = input("Please enter your DASHSCOPE_API_KEY: (OR press Enter to use environment variable)") or os.environ.get("DASHSCOPE_API_KEY", "")
trait_image_url = f"data:image/jpeg;base64,/9j/4QzkRXhpZgAASUkqAAgAAAAIABIBAwABAAAAAQAAABoBBQABAAAAbgAAABsBBQABAAAAdgAAACgBAwABAAAAAgAAADEBAgAcAAAAfgAAADIBAgAUAAAAmgAAABMCAwABAAAAAQAAAGmHBAABAAAArgAAABoBAADAxi0AECcAAMDGLQAQJwAAQUNEIFN5c3RlbXMgRGlnaXRhbCBJbWFnaW5nADIwMjI6MDg6MjkgMDU6MjY6MTUABgAAkAcABAAAADAyMjCQkgIABAAAADYxOQABoAMAAQAAAP//AAACoAQAAQAAAPQBAAADoAQAAQAAALMAAAAFoAQAAQAAAPwAAAAAAAAAAgABAAIABAAAAFI5OAACAAcABAAAADAxMDAAAAAAAwADAQMAAQAAAAYAAAABAgQAAQAAAEQBAAACAgQAAQAAAJgLAAAAAAAA/9j/4QDmRXhpZgAASUkqAAgAAAAFABIBAwABAAAAAQAAADEBAgAcAAAASgAAADIBAgAUAAAAZgAAABMCAwABAAAAAQAAAGmHBAABAAAAegAAAAAAAABBQ0QgU3lzdGVtcyBEaWdpdGFsIEltYWdpbmcAMjAyMjowODoyOSAwNToyNjoxNQAFAACQBwAEAAAAMDIyMJCSAgAEAAAANjE4AAKgBAABAAAAoAAAAAOgBAABAAAAOQAAAAWgBAABAAAAvAAAAAAAAAACAAEAAgAEAAAAUjk4AAIABwAEAAAAMDEwMAAAAAAAAAAA/8AAEQgAOQCgAwEiAAIRAQMRAf/bAIQABwQFBgUEBwYFBgcHBwgKEQsKCQkKFQ8QDBEZFhoaGBYYGBwfKCIcHSYeGBgjLyMmKSotLS0bITE0MSs0KCwtKwELCwsPDQ8eEREeQCskK0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA/8QBogAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoLEAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+foBAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKCxEAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD6PpjzRRyRxySxpJKSI0ZgC5AyQB34BNPrwTxz4ovdb8T3ej65p0thqNgJRbiKbKOB+9Tn+8UC9sHFZVqvs43sTOXKj3pGV87GVsEqdpzg+lLivEv+Eo17Q9E1aDSIbu9uJy7iXI3I+VXPmMfvYzgEHkHpmrmi+OdWsNUubq7lSZZtoEd0XUCFQQDxwpLd+epznFZxxUJIlVUz2GisTwX4ntfFWkm7tkMUkT+VPEWDbHA5AI7emQDjnArbroTTV0WnfYMUV5t4sur/AMM/EH7fZ3zyRXkYeW2fJUKBjHX1QkHjGSK7/SL5dT02G7RdnmL8yZztYcEZwM4OeaiNRSbj1QlNN2LVFFZ/iPVDouh3WpC1kuhbKJHijIDFMjcRn0GT+FW3ZXZRoUVgaB410TWkj8md7eZwWMFwu1lAGeTyvTnr0qsnji1Os29m8G2G5mEEUofJLHplccD8e4rN16emu5PPHudRRRWf4k1F9K0O6vIESSaNQIkc4DSMQqg/ViK0k1FXY27K5oYorwW913Vr7UpJJNRupZFchZlcoQRxlcEBfXj/AOvXpfwu8Q3Ws6dcW2ozfaLi0YbZyhUyIScA+pHQkdePqeOjjoVZ8lrGUK8ZysdfRRRXabBRRRQAV5x8b/CyXmnReILNG+2WMkYmVOssW7H5qWyD6Zr0eqXiCGG40G/huSBDJbSK5Kk4G05OByazqxUoNEyV0eN2pjuXYQDzjA5aKQBWyeDnBwM/Nkc8ZNWPDfg+Txr4m1N9SkurfS7Rxb7oZdrTbMqApA4BIckg9wB1yNDS7GNtA0nUoWZlvIQ6lwFLADapOAMfLt49q6/4XWgs9F1GMsGc6zfF25yf374zn2x/9evJwkOepqc9ON5anQ6fp9np0IisLaG3TCjEaBc4AAz68ACrNFFe0lY6jgvGNibrxBeT7gxgij4z0XH+LVufD9SmkTrngXB2jPQFF/rmq9ykP/CY3kbhys8cSyZ6DcpUY/75Bq54PBgW8tH+9FICfyx/7LXn05f7Q/mc8f4l/U3azvE5T/hHb9ZeVkgaLHPJYbQOPcitGs/xCnmaaVOCodWOf9k5/mBXbUdoM3lseTw6K4aAzGRAZV8sDG4nPcntnA6dj2Ndj4d0qFPE1vN5SHyWcq2T1KEAj14B/P1FMuLRbmJbm33MsZ3b+gYgDA9u3I6dq2fDyBZN/wAvysuMds8Y/U/nXiYfWsjjpr3joa5v4hmQaVabGwn2tWkHqAjkf+PBT+FdJWR4xiE2gyhjwHTI9csB/WvYxP8ABl6M6qnwM8U0qxWUBWCkfKRxgYHp356/TA7HHo3w+QrrjMMAG3ZSMD1U5/SuN0q2jlukSaTYrNhQfbuf8967j4dxg6hK+MbYyBznuP8AGvncLriI+p59L+IjtXZUQvIwVR1YnAFVU1SydtqzHPujD+lYfiCWSfXlje5lS2hQKIVwA8hO4t0+bAwMZ9aq6vBdWQUNcEjDOfJj5fH3QevXPb0r1sRjpU5NQV0tzvc3fQ7BGV1DIwZT0INLXHWuq3mn3zh4i0W0FW37g+cbsgenr/SuttZ47q2iuIW3RyoHQ+oIyK6cNiY11po0VGVySmT/AOok4z8p4/Cn0jKGUqehGDXSUcNptgsHgnR44/mS2+VCMfc3ED9MV0XhqHyLnWEAIQ35kXP+1FGx/wDHi1Jb2EkemmweBzsyqsuMEZJBFaltF5QckYLtuIz7AfyArzsLSlGd2uiM4Qs7ktFFFeiaHL6jDLJrOstGCXSK2kjHuu/OK07BQNZMyD5Lm33H6gj+hqee2ZNRa5WMuksao+3qNpOP/QqdaQMksf7tlSOPaCx69P8ACuNU2qt/6/rUz5dblyquqp5li65xkgZ+pA/rVqmTRiWF4ycbgRn0rraurFvVHO6HC39gNHJjck7Kw9McVb8PwjyVOP4gv/fI/wD1UlsZbZ7qKS2uP3pLjbGWG/vyO2cEVe0mExQqpR1CLj5hjJPWvOo0GqkdNkzKMdUXazfFK7tAugOwVvyYH+laVRXkC3VpLbucLKhQn0yK76keaDj3RrJXTR5FZWbXOtvbqGWNZGLEDtnr+ortvACfvrmTjkEH25H+FQWXh65stRknlt2lLoFHlsMcHr+PFb/hzTnsYZGkXa8rZ256ck/zJrwsHQmq6bi1Y4qNJqabRyupJd6V8RZV+T7LqgWWN5FZ1YgAOuAQMjGcns1bWv3bvbsYsbRgsMZ4/wA//qNa2u6TFq9gbeVmjcHfFKv3onHRh/noTXINZeIo3a3k02SWRcBZopVEbYGAeTn8Otd1bCu8rbM60uVszhqbRzJbq9xNPtSKFEizlvug4/nzjjPTNelwRJBCkUYwkahV5zwBgVgeFvDjafO97fiI3bZWNYySI1PXnuT6446eueirTBYd0oty3YRjbcKKKK7izy3R/Anjy0XV3uvFBlF0y+VbNfzujp57u6byoMBaNkj3oGIwSMHFejaJHfxaTbJrE8VxfBB58kS7UL9SFHHA6DjnGauUUAFFFFAHDeJfCniXUvHI1ax1ye105IUVbSPUJY0ZlWQ/NGFI+Z2jyQRhUPBJ4l+Evh3xV4b06+tvGGtjWWecNazGeSV1jAxhi4HPQ8cda7SigAooooA831/wj47v/EXiGay8QxWun6hCsdlsvJVktzug52hdq4Cz9DyWXPVjXTfDbS9e0bwha2Piy/j1HU43kMlykryBwzllG5wCcAgfhXRUUAFFFFABVbVorifSruGxm8i6kgdIZc42OVIVuh6HB6H6VZooA8Sj+G/xX/4ROKxbxso1GOeWT7SNTuTvRo4UVCdmcApK3sSMdWr2xd20b8bsc46ZpaKACiiigD//2f/AABEIALMB9AMBIgACEQEDEQH/2wCEAAcEBQYFBAcGBQYHBwcIChELCgkJChUPEAwRGRYaGhgWGBgcHygiHB0mHhgYIy8jJikqLS0tGyExNDErNCgsLSsBCwsLDw0PHhERHkArJCtAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQP/EAJ0AAQACAwEBAQAAAAAAAAAAAAAFBgMEBwECCBAAAQMCBAMGAwUGBAYDAQAAAQACAwQRBQYSITFBUQcTImFxgRQyoUJSkbHBFSNi0eHxCCQz8ENTcoKSshYmojYBAQADAQEBAAAAAAAAAAAAAAADBAUCAQYRAQACAgIBAwMEAgMBAAAAAAABAgMRBCESIjFBBRMyM1FhcSOBNEKxkf/aAAwDAQACEQMRAD8A/R6IiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIo3MGP4fgMDJcRm0d44NY0C5P8ATzXkzEe5vTXzfmKHL2GSVDmiSVrC5rC6wNupVUyp2nQPEzc0O+CL5SaZ5j8JisLF1uG91GdsNSytxePD2zQyRviDnMbJvYEX9xsVRMdo6wziWRhMbTo7rmzlp9RZUM3JtS+q/CvbJMW6d5x/H46PL/7Sw58NUHloicHXa6547eS+Ms5mixtxj+HkglDdWkm4cOFwf5rh1BTvipC9jzFaz33PgAtufTiLq39l2ZMOwN9U6vc8R1eh0UzIiQACdnc9iei9pypteN9Q9jJuXX0VaxfPGGUeWKvGKPXXCm8Pw7Doe59rhvi4bb36Ln2Xc+41WUlPWCrlAe50ggmIcSwnwg+EXFuY6K3bLWqSbxDr8lbSxz9zJUwMl06u7dIA63C9uizrgOM4hiGas4y1copmNhZHGPhnEOsSS29z8pvxHO3Jdey/mOgfhtFDU4hC+rdpieC6xL7dCvKZYtaYIvEzpYERFK7EREBERAWpimJ0mFwd9XTNiZewJ5rbXNe1+GY4vh7n1Y7ktcWQ2+QjYnzvdcZLTSu4c3t4xtfMKxejxSkjqaWZpZLfRcgE2PRby/PWD14wnHKaeeWR9O1w7xsextcbjzXb8uZhpMcp3TUmpsbXaGl5sXG3IKPFmi/U+7mmTySyIinSCIiAiIgIiICIiAiIgIiICIiAiIgIiICIonNmYKfLmFOrKhpkcXBkcTXAGRx5C/QXJ8gvLWisbl5MxEblKkhoJJsBuT0UZUZmwOnIE2MYewk2ANQ3+a5Dm/NFXj84qaiQwUOgiOBriQGk38Q+246QbHbbpxjG6m3DGR0wItoAa+W38Rds30AWZk+pRE6pG1e3Jj4h32jr6StYX0dVBUNH2opA8fRbC/O0NXW4bVtnwqprqabTYvMV/a7L7eoK6BkTtHlxDGo8KxiSn7xzLa2jSQ4cNXr6DkpcPOredWjTqmeJ6l0lF4F6r6cREQEREBERAREQEREBERAREQEREBcJ7d8Txutq2QOjFJTwvc1kUgLTI3m4EfNwGwXdlDZzwaHG8v1NPNF3j2sL4rDcPA2t+Sjy1m1dQ5vEzHT84nP7JXRwVkJcTEA6XQBpYdhdouSOFyN+HvYO9FdhIqKV7XQS08jGyM38IYS035bgfiqhWYQInMpHtN6WscI3PaQ9jHeJrB76fwKnchy1JqcTwjEGMbUHU1jWbMu1ngI6XFwR1ssq9a63CtaI+EtRE1GXacyMa/8AdxjYWMgsfCf+4bnyus8UtHFhbajEJo2U7Y/ESLXJvwvx5WHEr5oWtp8tSFxa4RuY129g3wm9+dr8hueHNZm4ayuwugZMSSWGVxlYGv8AES7SB8ouLbC5AUDhA5kzK+XLhqct4ZUzVQkDY59TS0AbEll7gWOx6281iyXXMny3PiTGzyVbHhk1I112MeLkvDQPBcix5eQJVjrqDBaegbBK+INkaYo443X1ONwAGg3vx5LBDl+nYIqrDGQtdUxsdqbFoc5m3hPO4A2Hked1NXLEV1MO4tGkZl/DJ24jHXtnZH3MzomRtiIeYbEnUb/Z4A8DwPIiRlo+9xVsk5bUQRPaYnPaLvlO59OI4dN+K+cxwNoqF9NQ+D4ght+BaG8t+R2HK1uK1muqpYaKSGWnkdKXSFkpd3j9RBDAAQBcMG54A2XVcnk9idpiHNeYsLx+kxWodXOw6Fojli0mQPYXW0gEbPvzvyHVdRyxnShzBXOpqaGeI2JY6Ww7y3G3ouMV2JV+JUk37WHw1Q92ltLoBa6O5AB3Nzb6qwdnlY6nx3CsNihEb2yjvHWd4W6b8+F7DyU+HkW34y9rknenakRForIiIgKIzTgVHjdA4VUbTNE1xhl5xmyl1pY9UtpMGq53GwZC4j1tt9V5MRMdvJ1rtwvMNLGyouxpbawIPmL/AJg/RS9JNNRPk7iV7JWPJjDDa5HAg+61aiJ1SKgP3OiIguPyt5j8CtqOImuDC12rZ5df+EON/wAlkzPfSlM/s6bkrEKvEMNfJXSiSQP0jwgclOrnGTJZKXHI+6ka1rx+9DnaWub/ADuujDgtHDfzqs4reVXqIimSiIiAiIgqPaHm2rytUYe6CCnngnL+9a8uDtrfLb16KGw/thoJnRtqsNqIrmzjHIHgflsrD2mYPFiuVqh7g0S0oM0b7biw3HuP0XFqKiZK5xaCHEaxbobAfUrP5ObJjv6Z6QZL2rPT9FUlTDV00dRTyNkikaHNcOBCyrgVFW1sVO6nbUyMi2cWNcbAA3F/zt5q4ZHzj+z5p4Mbq5XQvsYiQ55DjtYeRXWPm1tMRaNPYzRM6lfcexSPDKTUXtE0nhiYftFUbEsxYzNeN1WYWngI22P80xfGZMXrJZXRiFjLNaA69gDsfXmoxkrpIpXaQ0x6gA4kkkHmqvI5NrX1WekWTJMz0m8q5wmpKmOgxcyPbI8MZK91y0nYA9Rey6CuD1MFZX4p/lO8LmOBjdFclzxsfXh05Bd0pQ8U0YlJL9I1E9bbq3w8lr1mLfCXDaZjUsiIiuphERAPBcZzc+qx/P1fTVs7m01JqhijGwY2zbn1N+K67itUKHDamrda0ETpN/IErj1E8zYPLidbK5s1RD++kcbmwLrm/U3+gWb9RvqsV/dW5M9RCvVtTG+fv2MdfcUzWmwjbw1nbibbenkFgp4YnsaZ/BESdO5D5D0F/qV8wSGqqHSC7N7lw+WJo2A/S3FbLI42vbLUB752w6xqNxYnwg87+XJYsypvukc14Y2JmljuDTCDf039VlfhrHzOq54i3S2zXsIaT625LJERBC4Bo18X2FiT/LyXklHWSmPuZ+7p3sLHMts08nEetl5ty6/2e4pPiuXI5qp2p7HGPXquXWA4+asK572XTRYbWPwzW4mdrpLngXtsDb2P0XQl9Hw8n3MMS0sNvKkSIiK0lEREBERAREQEREBERAREQEREBeHgvUQcv7UcrOZWuxiGPvWPlY+Ww3Zaw38uJv6rklF8Ya6nnjc6KpZ3j5WEHxzaidZt52AHHZfqepgjqYHwzNDo5GlrmnmCvzzn3BKrLWa9UMwMGp+iF17y6gQLW4ndv4cVncnF4T5R7Sr5K67hs0OkYZXQRsu4VMfdiTgbiQi/oDv1O3NS1WWd/WPsZTEO5hLm3DdrWaOWwJPM2HELUpWMo4MOdFo0yvgExIuS6JkhcDbn4QfMrJhsxNRBSva4yh/eyaiAGutqdc9AAAff0WdMoSmw6GOoFfIxk1eywc0s3Didt7cBccDxB8lKCrE1TExzIhoee8BIcQC03Ppx58/ZalOyPEohMwtAlAJkY5xe/ci9zuASDby+uaOGHD6KeSJ2qSKO4a5zblxcA0Ect3Wt0XMz2Kbm2p+NzdR4a51/lcSXhrTue8B5nwh34FY31DqgVEkUUhsLRvHiLGus5vdgDawA26gb3stXAJxV17MUYRJUAyCnfJCHFry91y42vs29/Xku0dl+W5aam/aWKU/dVLiWxwm9mC/zC42uruPHNvRCSI36YVfsmyZiFXprcxCZrTaXTpIa53CwuOFt/e3JdVmwegnr4K2SnaaiD5JBsbcgeo9VuherSx4a441CetIrAiIpXYiIgKB7QJ44cr1IkcW96WxtPmSp5VztINstElhe0TM1NBtcX3XGSdUlzf8AGVBhpj8KS7ZxpnxubbmxzT/6hfTY3iUuDdxTxtHm5wH6AqYp6QvoJdDtYbHrBtbUNLhf14A+YC1XRBk8VPawaA9xPKzNvoPxKyNqMxphp2uZO3ug17w8Nbq4E8gupUhkNNH37Wtk0jW1puAbbgeS5dWRMfRODw1rLXBeSQAOZtuun4ff4GC5JPdtuSLX2VzhTvcJ+P8ALOiIryyIiICIiCNzTBUVOXa+Gj3mfA4MHU24e/BcYkj0xPjvHHI+QRsJsS4AA8Dx+ZdkzhVGjyviM7HvjeyneWuYbEG21vNc0xGgDquGmbFqcWt1b/bc0b/ULN52twrZ/eEa2MmLW0Fz5HXY5zdw0cbjyNh/NaFWGvnMDpixznN1vY8XABDiCeAG1t7Kahw51fXObJvS0YtGxx0tc4G5e7rd3C/Ky22wwRP1OkZITc94Lad/urOtOu1eZbOGwMrafvofCS0OAvdtjzB5gdEp6F0lUySVwLiND9J2vY2dbkTf/eyk6eAR0jJnQNjnbpBeWjxcB78l41jIK9kjgRFKRe/rYj1G30SO3sQ1sgYM6pzC3Eoy5kFEHRg8NZcOHnxufZdKVQyGKqHFsVpnM/ysZZaQnfX0t6WVvW1xaxGONLmKNVERFZSCIiCs9p+IjD8ozmwc6okZAGkE3DneK3npDlzzFaZkGWWUkrzpa1kZLXBtwN+J4cFd+2KA1GU4wxrnSMrIXsA6gm9/UXHuqZm6AzYb8PFYvlmbHHfhcnc+wBKxfqMz92I/hS5M+pVNvhu8s90feOEIa2weQLareR5ndb2H0sT46qorWvLhbU4vvbbZvmTx8gsToDU1rGU7AGMaGQd47aNg4yOHLr7rdh7p57qBhbRUrtPePZ45nnifInjfkLLLlVY8GpJC1k1SS6AO1jUdrAdPUe+ysUTI3xl0jA248QI33WhQ0742sMkfideTQ88ehPQcABxK39Lnn5muGwIaefso5eS2cv1DYsbpXNJtFMxp2336nnsV1MbLl9HDormaTezmG5PO+35/RdQW59Jn0Whe4v4yIiLWWhERAREQEREBERAREQEREBERAREQFz3tkwb4qCirWaAYZ26i4bW3H6hdCUPnOiFdl6piIudNwoeRXyxzDm8brLieAugpHDDWM74/Gd+0d4P3Zc1wc3z4/UrNgTRLFVyzC7mxO8JPFznWv6WaVnys2ipcXgbU6O81Pe652Z90kediApWDDW4fUVjXNsz4ousOBYwAN/Eut7LA9+5UyClZUUcdJK9z4meCRhc5gc61+W1gdrclqZiZRYZlCrbR0sjHtsYy1otJI51mgnYnxOB4cbKQoQ6Ope10XfOJ1uab6Wn+l+HUlR/aT8TRZDxE6o5WSsjhEL2gEXe0a223J4fyXtZ3aII92Ls/yhE7FqSOnndNCwP7yK3ha52lzr8xaw2813BosFzjsNgbU4YcUZNLKyWOzDL8wbqNm+gsbHzXSAtjh01Tc+8rOKNRuXqIiuJRERAREQFX+0CoEOX3sH+pK9rWeG4ve+6sCqvaXrOEwNbuwzeIW2+UqLPOsdpcZJ1WWllvRI8MtaOdhbb7jrbj3/ktLF6d0ddVN4u2YP8Autb6BZsvv7p0bnXLS4AOPHbhf0UpmakDZRUgbOtqPoHW/RZMeqm1WY3TaulrXxju3ANa9ova5sLX+i6NRztqaZkzAQ14uL9Fz/umsp9BAIGxuOf+7K+YQ4Ow2nI/5YH4bKzwJ/KHfG+W0iItJaEREBERBU+0xzn4XHTxuN5XhmgH5tRAH6qDrqR5xCV1Lf4iaYxROHFo4OcD5AWB6+in83UzajF6EjciePVvyGoharHCNwdFp+IqLthFidLOp6XNzdZHL9WSd/Crl7sjTSQ4dRtpKV12tF3uaCdR63P6qHni0SAOpg9xdezHb+pd1sOQ6KeqKZwY8FxqpB9qb5fZnC34lRssbqmtZHHLH8TcHS8WaBYnlvbayoX90Fk7TPZFRwxd2XNfGC9gduB1/qsElN3btAAdG46mE/e4f3X1pfUFj6imiEsYIDonXLP+k2Fx1H0WzTsZOzuo9rguYOG46fl7hd176h3HaTwS8eNVjd7Ssjfa3O391OqGoh/nYJ/+ZG1p/wD0plbnG/Bbp7CIindiIiCudo8L5MvNkj1/uaqGR2k221WN/IXv7Lnuaqn4ShbIL947VGy32bizj622911HNp05drCP+X+oXNMxxWjgnDe8milIgj+9Iflv5C1/ZYv1KP8AJE/wp8mPUrjqQ08ZpHEseWiSrmLvl6MAG5t9T5Bb0GiB8V4nagLU1Jcki/F7+rjx/osTI3RCNlO9s0jyXRk/8V/2pXHpxt5L7iEbWuYxz53zHxPGzputj9ll+J/PllzPxCskKVriS97mPmebuJLnafccT/sdVuxeIWj0mwvta7lHUkD3AiZ0dtO1meFnk2x+q36c6JABZv2Re+5tvbmo5cSksK0ueLBoc3kOXMLpIXOMGi01JZe+otb6XP8AddHW39Jj02le4v4yIirecc30OA1FNhzpHOxKtB+HhjYXOtexdboFq2tFY3KzM6jcpfEcUgohZx1ScmN4qFmra6rLwZxAy3BguW+vv5KJp6qOeq0P78udI6MvljIAINjcnmSpKaMtBYzYXuDx9T5rEzc29566hB5zZ8x1VQxtzWTXH8Qt+S3KauqmWDqki/ESt1H18lol4ieHtHyb26n1Wm6uiqXujFpJWBwkbvcHzVevJvX/ALPPLSy02MSneakkLDwkjId7kA3UpG9sjQ5hBB4EKoNqmEACKxB3F/lPRZYMRqKWQvgDnOvvETcO8+qv4Of8ZEsXWxFp4XXtroA/TofYFzb3tdbi1K2i0bhJHYiIugREQEREBERAWCvZro5W2vdhWdYMQlMFDPK2N0pZG5wY3i6w4BeT7EuNTUlLS4xFTyBr562sDXASEO7vYG48ht7q643hzIqeAsb4Y7bHe5Hy3/P2XN8PxSfGe0zDBPQmma6CSdj37PO4aQQDbkF2HGIg7D5Da9hdfPxj91SK7iZUpsDWTF5O/nwJ6eXqo3tAoXO7PK2rhN3wTwSNij8pW23G/MqalAa9zZr6CLavuj9B5rbzNSiTsyxYQG0kdO6ZpH3mWeD/APkLnFXd3NI3Lb7HZY6zLDK2JjYhKGt7ljA0RWG7fY3V0Cp/ZPVSVeXzLMxjJJC2STu2aWl7mhxt+IVwC3ON+lVax/jD1ERTuxERAREQFC50gbPgbw4A2e0i6mlXu0n/APjMQHWM/kVHm/Tt/Tm/4ygKGwphwPnfY+qsz4/j8GAduXR8fNVjBYXtwWkkc7UHxN8V+JturHl6S9I+G99J29CsfB1Op+VbF76n5V2oZ4H6gedwrdlqUSYUy32Tb9VA4zB3dS9ttiNQ9ypHJcwdSyxXJc0g/op+J6M01MPpvMJ9ERaq2IiICIiCtYrFqx2YOO2lsg/AtWtECWvnaNHeizS4fKwcPx6dFJ4sy9ZMW/M5gF/9+qrktcDUOc5pIBLY2DckA225Aef5rI5cxSytk1Et+VkAYQd9uIba605aBskT54napiPA6+khvS/LzPQKSw2lNdCZZHkN1fL5WXs1PricCP8AUO/m3p/voqn2p15THSPx+UbRSy1bLipeDxvoHiHp/ZbNGTFO/vABJcFwG9zyePXgfO6xwMjJu0NdJHsQOXktuBzKjSWXBabHVxtzH5H2C4xe/bynul5B3ccLmjcyjboCblSajZiWU0ZPFpb+YCklv4Y1C5UREUzoREQaOYIPiMFq4rX1ROsPTf8ARc5xgRmgkkmDixu5DPmd/CPXh7rp9YL0so/gd+S5pVucKCQxs7x4Z4W34nksj6nHqrKpyY7hV5GvJcJHNNTP/qu4NFvsC32G8z12F1t4dSxuOqcPe0gO0AXdMRsLgbADkOA8zutekhOputzXyykG52D7f+rBv+H4ZjUWkEbNTte77XBfb7TujegHJY8yqTKcoYXS6pS5gLWHgb2HQbW+qwMmi791mWft4S42bzHHYH03WeimDqBwaHRyWI0i42INv0WFj2iSwe1znWJLW7ONtyei5nr2cpzLjWyTwBo+aZtx73/mr6qVlmICrpdPAuvbpxV1HBb30qNYpn+Whxo9Dw8FzWsoqfFcx1ePtgl7537iIvLSWsaLWHQXudjzV6zHLJFhUohNnyDQLGx36eap2G1jKeKOKeF8Ona7W3bf2T6jm1qkPc0/CYijp8QAmiaWzDxPjds69tzb9VjxDCZf2n8RTTTwMkiJcyM+HVcb26/zKx0tqiTvaSVutpuPDuPayskBE0DHu4232tuqFMcZYn93tKxMK3jcVXC2naZWaH7SPczcG23otCnwemp2vfDra/fW5pOp1+NyrBmQOLImRgOLn/KQTqFuGyhq6eRgc2JkzyRpMdrA7cSSLkeircinhfUPbUjbyiENVTkU7NEEDtHeEWL7Drxtv7qNix9kGL/D1tNJTwhgLZJ2OY7Y2+Uj5eG/mL8VK4BA6nwstrZjPPK4ySXFmtaTYNA4Bu3Ba9ThrIJGyQESsYdqaZxLW8R+7O5adyLbgjY8BZWuvdxNdNmOoNBR0zm1Lnltm95G7UdP3jbiOCs+C4k2vY5pLTLHbXp4b/2VNip3uiIpwxhf9lrjpi9ALfW638n4qRmaow+VpdqhZplBJbqaLubv6q9wctq5YpvqXtJmJ0uaIi3U4iIgIiICIiAvHbherw8EHFaqikj7WsOqnaWRCOSJoL93FxLtm9Btc+a6tVs7yke3qzh7KgY1RMOcMNrXa3SMkjDSTtG11wbDzsF0Vw8FvJYePubQgp8wpD2t+KBl6kFp4OFuCsdBRsny9NR2u2WJ8VvItI/VRFdEI6zcbB535qewHanIAtZw26BRYOsukeKNX0q/Yk4nBYG925pjpWxucRsbOIAv7FdDCoXZbH8FieLUTTtHUStI6aXm30KvoWvwv0Y/3/6nxfi9REVpIIiICIiAq12nP0ZNrSb/ACH8lZVWO1JurJlaL/YPK6iz/p2/pzf8Za2DwibLdM+IB2mMOBH3SsmBS6Kwx8NQP4hZclt/+s0jbnemYLg78FoxF1PiTdQcLP8AtCxWZaNeNla0a1KYxyASwiQDdq1spO0V8zCfmBNlKvYJadzTzCh8H/y+YWtPBwLVJEazVt+7uY1eJWlERaiwIiICIiCIxTw1r9+MQ/NVGNwZPO7SAZHhjL8AG3+g291cMWFsQiceBjO3of6qo4jE6CuLSNmnS0DmOP53P4LI+oxO9quaFpy40GjkYDfxWv7LytaQ8hu1jpYOnmvcuBzYXggC4BK+68XnN/w8l7X/AI9Zdx+EIIMLMQcGtGjRsQD9VuQxubMJIxfVsW9Ty/35rHV/uqhjy4+LY2G3ktyjZqkaBwuOCo0r69Ior23qpuunjaPtOaB+KklpuGqpibyBLvw/utxfQY41C3AiIpHoiIg+Jm6o3N6ghczmDDTSCRhe0N3Y3i7y9104rnJYW1EjTYaXEb+RWV9Tjqs/2rcj4VZ8UuqS7WOmdYvubN47NA5MFufG3QL7i/dSmKOMulcdUjgzV78R9dkqwYpXtjaWumJexrmlz3/xu9eW4ACxR2aHNjbrJGkgxWLj+Hy+p3WJKjMJGijZqBEhBJHivc39tlvSxCSZgILNO4HDy2t0WTDqB0FF8RMyIODb2a3xHp6LGQZnWALbn5nHceh439V5rTxZMqNJqqUn7pP0Kt6quV26a2IfdjP5K1L6H6bGsP8Ato8f8FO7XZjBl2mc1z2H42Oz2cWnexVXwnMMrKlseIPirY5De9g2Qemkb+4V/wA8YY3FctVcOkukYwyxgfeaLhchwTHi+ICjwp0suvunPqZ9JY4C9i1o3vxHVQc+tvPfw8y/k6fh9NDVME1G8ne9nAtc0+ino7iIahZxG/qqPl+txOSeF8bad0ROiRnd2dE+17E34Hqrk2o7yBr7WJ4joo+PqImUmP2eVBYTq4uYDY9FDVlTMdRhhgI4Audc/UgLcqHPeXta8NBdubX2UDPLWT1MjIHNigZt3j2i/qb7AKHkb30lnp5hFzidS2SYPmlYHE3A0BvIW2tuvaivpaislw+mnHewgOlHB7mnm2/EeYUaIJnYgZqSoE0QHdzyyNGhzSbloAG5P04novgxwT1Lqmc3kY6/ejbxWsGi3IDj6C6rRHW5QW0loZGNc86gxgP2Rbbh+ikcvxCXMjJWQNBipXmWUAXBe5ulp9mkqFY5sTRJYvcNm6zcnqfxVkyPAWU1VO/5p5r3ve4DQP5q5wK+WX+ikdrCiIt5MIiICIiAiIgLx3ylerxwuLIOe4jEJMbomg+N2jSOtjc+1grsN2qnVVIG5qoawl5c2LuQwnYXcbn12CuMfyBYmLq9/wC0OOO5V3HadoqmudsC7VfmPfkpPAtoSNxsNivMZg7yLUCAQea+8EIMb7ciuIprM8iuronKURizpj7PCW96H7cRqa0q3hReDxMbiWJSNia1zpmgvA3fZjfyUoFr8avjj/8Av/qasah6iIp3oiIgIiICrnaVEZcnV7Q0uPdE2HFWNROcIPiMt10Y4ugeB/4lR5o3jtH8Obe0tPKo04TSgkn903j6BYMepO5lE7XbPPDfZbGXN8Mp3H7jCf8AxC3MYZqw99r3G+yoXrvHpFNd1ZKV2qEHqFHTx93jdLI3a7wCt+hH+VZf7oWGuaBLG63yyNSI34z/AE694hMjgiItNKIiICIiCPxhv7ynfy1Fp9x/RV7M8JEsEw5jj5qy4w0mhc4cY3B/4FQ+YIhLhusD/Tdf2VLmY/Kkoskbht5a2oyNja24N1nxBnA9TutHK7wInNvaw4KUqm62C39lHj9WCCvdEHiHg0mznEXvbiVu4M27zzAF1qVpLqhjWkbX9/JSeFxtjgLh9oqngrvM4pHqbUAvVE9Gfmf6LZWvS7ukd52/D+62FuV9lgREXoIiIC57iDNGJVLSdhK//wBl0IqkZjh7rGp9tnnWPcf3Wd9Rj/HE/wAoORHphTsUZIKl13PMsz3PcGuA2vtc2J9AF94dC+WYU8fC99zqJPQn+q3cUgAlZMfrtv1X3lqJxrdV2vu3fjce5WDb30ozG5TlFAYYCx7i7oOih6dh+JLS2Q7kF0kgN+Wwv+isQj8J3URHAz9qSi7QSQ4Ac17ePZ1autaWTLLAa5x+7ER9QrEoXLMdnzvItsGj81NL6Lg11ghfxRqjwi4XIM3YG/LGZHupAyGkrHmWn1bR6uLmOPLqOnEc12BR+YcJhxrCZqKcCzxdriPlcOB/FScjD92uvl7evlCmZXr2mbvHxOgk2Y9jx7jfmOn0KsffgRnSbAPuqfQS1GEmairGuaYSQB09PL+6mIawSMmAd/EFn466rpzjnUaST3kzSEcRv+qiscjbLI2SbW+J27YI/tHqeQHmVsNqQZA6/wAzQStd1U1sboZAXNa76Ly+PyjSX4RlXU2jtIxz3FobFBCfCB+Z9efJRVVXMpZoviQe+JtHSxEa3W3t0aOpUxXEN1iBobze8Hc+rjutIxCG8z2RRgt3axm5HmeKpWr3pXt20qzEK6HDpJjGJKlw0xQQ3N3k2a0eVyN/Urp+UKGXDsuUNNUkmdkQ70n753P1KhsiYK10LcVrGXkeT8Mxw2jb94eZ/JW4LW4PH+3Xzn3lJjrrt6iItBIIiICIiAiIgIiIKvjNIG4tC5zRpE2xPIO3v+IspmJwMYsVkxOiFZCQDpeB4XKPgbUxnRJBK4jiWt2WdkwzXJNoj3cRGpbk0YkjIKw4XCIIHlxtqcT6BfbG1L3WEJaP4zZZoqN3/GeHAm+kCw/qlMFptFtPdd7e4dD3cb3m+qV5kN+V+H0AW0EsvVoRGo1DoREXoIiICIiAsVXF31NJGftNIWVF5MbjQr2BjuqRkJ2LGhpB6jb9FK6RLGWuGzgsNXhzhMZqU7ndzDzXkb52NIdDJf0Vaccx04iNdMsDNELW9AsFSNbw0Hi9o+qyXmLQGxSX8wvukpJDMJZ7C27WgryuKdwa+G8ERFbdiIiAiIg+ZGCSNzHcHAgqEYC6B9NL87Lsd6jgfwsp1RmL00jH/FU7S91rSMHEgcD7Li9dw5tCJwV/wtW6F5tq4DzU99gjiq9WOa7TPAQXsOrTfdbUGMwviuCeHDSVSwVmm6Sjr10FnfVhsPlcpMlsMFibACyjaWaMuMgdqJ3Oney3qZslVKNcbmxN38Tbal7xsM13afl1WG9SsLIWh3zcT6ndZV4F6r6QREQEREBV7N1HqdFUs5eB36fqrCviaJk0To5GhzXCxBUOfF92k1c3r5Rpz+qpe/p3MsQ7kR1WXLlHpu+Rul+q3TZWKfA3tJ7lzXN5BxsQtZ2HVUTzphfueLd1hX4mSs91VPtTE9w9dGA03WhBBrndKQCBcXPVSIoK5zd4tj/EAVt0eFus0TNaxjfsg3JXteLkvOvF39uZn2bOCQ91QgkWMh1e3Jby8aLCwXq38dIpWKx8LMRqNCIi7eq9m/L37SiNVRgCrY2wHASDp6qmUFSWzBkgLXAFjmniCNrFdUVezJlaPEpTV0b209ZzJHhk/wCodfNQ3xRPce7ia/MKvSTa4WXPAlpX1O4EaifmbYocv49BK+IUHeXOpskcrS36kWWzTZYxuTaaOljaTfxTXI/AKt9mz1otmZLHrbK1jWfM4g7W479fRb+UcKOLVb6iohP7Pb8jn7d+fIfdCmaLJlGIx+0HvqXEglrXFjPwG591YIIWQRNjhY1kbRZrWiwAXtOJ6/K3safQAaLAWA5BeheorzoREQEREBERAREQEREEDnfOmB5Jw+KszDVmBk0ndxMZG6R7za5s1u5AAuTyUTX9ruQqGUR1OZaJpLGyAtD3NLXNDmkENI4Ec1zr/FHR1JzDglVgwqf2w6nkZT/BfEOn7sPHekCMFobpebk72v5KgY1g2J0lNlSpwCkwqsoa+llqabDaOGrkZWinIcBPE53jJc8m4A532R4/WrJWSQtljOpjm6mkC9xa6jMp5nwnNmE/tLAqoVNN3r4XEsLHNe02LXNcAQediOBBXIP8ROMZkFNHhtHU1VDBSYDLXYk6lBZFLIXxsawO8nb2BvYqUzBJ/wDEGYKcitLMexapgxGvwyFmp+KwhobLYnZpF9WxH2jug7Ci8abi9iPVeo9EREBERAREQFrYrXwYXhlVX1ji2npYXzSuAuQ1oJO3PYLZVM7coG1HZXjsb8LkxRvw5d3EcvdltjcSX6MIDiOYbZB94j2q5Nw7CcPxCsxunijxAQmKMn961souxz2fM1ttySLBS1dm7AqTLdXj37TpqnDKNrnTVFI8TNba1x4b3O4281+d8Ly5imVOzSgzfBl3JNRTVtNRsdHiUE1XM4uIY1/iOhty/UQ23G3IK09o+Ta3LnYPjVLiGBYRVTPxCSvLcJkkhgo9Td5g15udJBGgbWcLDZHjplb2oZNoMZ/ZeI49R0VT8LHVD4l3dt0P3b4jtqtY6eNirLhtfSYpQQ1uHVEVVSztD4ponamvb1B5hfkXBsOxnK+J19PBh+JTRR1dIa2GjpmVcLIZYC/uyS0vLvE0NtYWvfey/R/YW+N3ZJlxsckbzHQsjkDHA6HjZzT0IOxHIo9XNERAREQEREBEUTnGmnq8r4hDSYhVYbM6BxbVUoHeR2F7tvtfa3vxHFBE4r2iZSwvOlNlitxGBmLVJAEei4Y430te/g1xtsCb7jqFP47i1HgWC1eKYjI6Kko4XTTODSS1rRc7Dc+i/K2GZXxHEspVP7Lw7OdTgmKu+LkkfQUcrprEkPMpdrJG+9xz6q945SGs/wALslSxuLZkgmjNVAcSqWtloI2hwD7t+cM0k6Te9/ZHjplV2o5MocUgoK/HKWimqKJldGak900xP+XxHYOPHTxturNhWI0eLYfFXYZVQ1dLO3VHPC8OY8XtcEceC/ImW6HGMtYjVCjoMSljbJhs9XFR00dXEyCVhcWOLml9y0jSG7buB4Ar9E/4fCwdkGAQtex0kFOY5WtdcxvD3amu6OF9wdwgvaIiPRERAREQEREBeWXqICIiAsNdVRUVHNVT6+6hYXv7uNz3WAubNaCSfIC6zKi9v9LiVb2UYzTYPA+aeRjNQY/QWxhwc9178gCbcxsgxDtw7PTF3ox5xZq0XFFP83T5OPkrRjuZ8LwPK8mYcRmkiw6OJszpO6dqDXWt4Lar7ja1wvxvHTtGDhjalvwGo1D5wD3hZoFh8vAG7r8d11DOlHikn+FfDxjOBzVktK4PiqZa0k08P/Dn3J1AtcGhnLVwFl7p5t2Sv7TsnYbj1Rg+J49R0NZTxRyvbVP7ttni4AcdibWNuVwrJQVlNiFFDWUM8dRTTsEkUsbtTXtIuCDzBX5GosMxnK8mL4ezDsVqImV5p6uKlpY6uBofSkiPXpMhcCWgHYWF9iv0t2OyRP7K8siCaKYMwyCNzo3hwD2sAcLjmCCD5hePVqREQEREBERAREQEREBERAREQEREFYzn2f4JnDEqCtxoVpkoI5Y4hT1T4ARJbVcsId9kc/W60ss9luA5dxnDsSo5sTmlwylNLRx1FWXxwNIs4tbYAEjj1V0RBoZhwahzDglXhOLQ9/RVcZjmj1EXB8xuD5quZO7Lcs5TxgYphkNZJWNg+Hjlq6t83dx/daHGw4K5IgIiICIiAiIgIiICis35epc05eqsGxCarhpqoBsjqWYxvsCDYOHI2sRzBIUqiClYv2UZcxX9jx1RxEUeEQxQQUMdY5sD2xm7C9v2iOvFTGecpYfnTAjhGLyVjKV0gkeKacxF9r+EkcWm+49FOogpOLdk+W8QxibE2uxWiqZ4445jQ4jLAJAxoYzUGnchoA9lY8rZfw7K+BU2D4LB3FHTAhjC4uNySSSTuSSSSVJogIiICIiAiIgLFVwMqqWWnkvolY5jrGxsRY/msqIOZ0vYDkenomUwixZ4Y3TrOJSgnzs0hv4Cynqjs2wWfs9p8mumxFuFwNDAY6nRI5oJNnOA3BubiytyIKRiXZLlqtxL46M4rQ1Bp4qd7qHEZYNbI26WatJ3IaAL+SsWU8uYblTBIcJwWF0NLCXOAc8vc5ziS5znHckkqVRAREQEREBERAREQEREBERAUbmXBIcwYVJh9VUVkEMuzzSTmJzm2ILSRyIO4UkiDmo7B8mil+GAxXuNGju/jnW08LcFMYp2YYJimT4Ms11VjE2GwStkax1e8uLWt0iMu4mMC3h6i6uSIKTjHZRlzE8arMUL8WpKmt0mo+CxGWBkhDQ0EtabcAFZst4Hh+W8DpcIweAU9FSM0RR6ibC9zcnckkkk+akEQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREH//Z"  # Replace with your actual base64 string
WORKSPACE = input("Please enter your image directory (default is current directory): ") or "./"
WORKSPACE = os.path.abspath(WORKSPACE)

def judge_image_type(trait_image_url):
    lower_url = trait_image_url.lower()
    if(lower_url.endswith((".jpg", ".jpeg", ".jpe"))):
        return "jpeg"
    elif(lower_url.endswith(".png")):
        return "png"
    elif(lower_url.endswith(".bmp")):
        return "bmp"
    elif(lower_url.endswith(".webp")):
        return "webp"
    elif(lower_url.endswith(".heic")):
        return "heic"
    elif(lower_url.endswith((".tif", ".tiff"))):
        return "tiff"
    else:
        return ""

def encode_image(image_path):
    with open(image_path, "rb") as image_file:
        return base64.b64encode(image_file.read()).decode("utf-8")

def get_image_url(image_path):
    image_base64 = encode_image(image_path)
    image_type = judge_image_type(image_path)
    if(image_type == ""):
        raise ValueError("Unsupported image type")
    return f"data:image/{image_type};base64,{image_base64}"

def getClassify(trait_image_url, case_image_url):
    completion = client.chat.completions.create(
        model="qwen3-vl-plus",
        messages=[
            {
                "role": "system",
                "content": "请你按照{}的格式返回结果".format(
                    {"reason": "string", "class": "string"}
                ),
            },
            {
                "role": "user",
                "content": [
                    {"type": "image_url", "image_url": {"url": trait_image_url}},
                    {"type": "image_url", "image_url": {"url": case_image_url}},
                    {"type": "text", "text": "请你根据第一张图片的分类信息，得到第二张图片属于哪一个类并说明理由。"},
                ],
            }
        ],
        response_format={"type": "json_object"}
    )
    result = json.loads(completion.choices[0].message.content)
    return result.get("class", ""), result.get("reason", "")


client = OpenAI(
    api_key=DASHSCOPE_API_KEY,
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

# 创建CSV文件并写入表头
csv_filename = "image_classification_results.csv"
with open(csv_filename, 'w', newline='', encoding='utf-8') as csvfile:
    fieldnames = ['filename', 'class', 'reason']
    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
    writer.writeheader()
    
    for root, dirs, files in os.walk(WORKSPACE):
        for filename in files:
            if filename.lower().endswith((".jpg", ".jpeg", ".png", ".bmp", ".webp", ".heic", ".tif", ".tiff")):
                image_url = get_image_url(os.path.join(root, filename))
                
                try:
                    class_result, reason = getClassify(trait_image_url, image_url)
                    
                    # 写入CSV文件
                    writer.writerow({
                        'filename': filename,
                        'class': class_result,
                        'reason': reason
                    })
                    
                    print(f"Processed: {filename} -> Class: {class_result}")
                    
                except Exception as e:
                    print(f"Error processing {filename}: {e}")
                    writer.writerow({
                        'filename': filename,
                        'class': 'ERROR',
                        'reason': str(e)
                    })

print(f"Results saved to {csv_filename}")

