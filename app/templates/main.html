<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Chat Agent</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #1e1e1e;
      color: white;
    }

    .container-fluid {
      display: flex;
      height: 100vh;
    }

    .chat-area {
      flex: 2;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #333;
    }

    .message-area {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background-color: #1e1e1e;
    }

    .message {
      display: flex;
      margin-bottom: 15px;
    }

    .message.user {
      justify-content: flex-end;
    }

    .message.ai {
      justify-content: flex-start;
    }

    .bubble {
      max-width: 60%;
      padding: 10px 15px;
      border-radius: 20px;
      word-wrap: break-word;
    }

    .message.user .bubble {
      background-color: #434343;
      color: white;
    }

    .message.ai .bubble {
      background-color: #444;
      color: white;
    }

    .input-area {
      display: flex;
      padding: 10px;
      background-color: #333;
    }

    .input-box {
      flex: 1;
      padding: 10px;
      background-color: #444;
      border: none;
      color: white;
      border-radius: 5px 0 0 5px;
    }

    .send-button {
      padding: 10px;
      background-color: #000000;
      border: none;
      color: white;
      border-radius: 0 5px 5px 0;
      cursor: pointer;
    }

    .send-button:hover {
      background-color: #000000;
    }

    .function-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 10px;
    }

    .file-area {
      flex: 1;
      background-color: #222;
      margin-bottom: 10px;
      border: 1px solid #444;
      border-radius: 5px;
      padding: 10px;
      overflow-y: auto;
    }
    .file-area .section-title {
    font-family: 'Microsoft YaHei UI', monospace;
    color: #ffffff;
    font-size: 20px;
    font-weight: bold;
    }

    .log-area .section-title {
    font-family: 'Microsoft YaHei UI', monospace;
    color: #ffffff;
    font-size: 20px;
    font-weight: bold;
    }

    .file-area .section-title {
    background-color: #222;
    padding: 5px 10px;
    border-radius: 5px;
    }

    .log-area .section-title {
      background-color: #222;
      padding: 5px 10px;
      border-radius: 5px;
    }

    .file-input {
      width: 100%;
      margin-bottom: 10px;
    }

    .file-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    .file-list li {
      display: flex;
      align-items: center;
      padding: 8px;
      margin-bottom: 5px;
      background-color: #333;
      color: white;
      border-radius: 5px;
      transition: background-color 0.2s;
      cursor: pointer;
    }

    .file-list li:hover {
      background-color: #444;
    }

    .file-list li::before {
      content: "ğŸ“„";
      margin-right: 10px;
    }

    .log-area {
      flex: 1;
      background-color: #222;
      border: 1px solid #444;
      border-radius: 5px;
      padding: 10px;
      overflow-y: auto;
      font-size: 13px;
      color: #56955b;
    }

    .section-title {
      border-bottom: 1px solid #555;
      margin-bottom: 10px;
      padding-bottom: 5px;
    }

    .overflow-y::-webkit-scrollbar {
      width: 8px;
    }

    .overflow-y::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 4px;
    }

    .overflow-y::-webkit-scrollbar-track {
      background: #222;
    }

        /* é¡µçœ‰æ ·å¼ */
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 10px 0;
      height: 38px;
      background-color: #222;
      border-bottom: 1px solid #333;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    .container-fluid {
      margin-top: 60px; /* é¡µçœ‰çš„é«˜åº¦ */
      height: calc(100vh - 60px); /* æ€»é«˜åº¦å‡å»é¡µçœ‰é«˜åº¦ */
    }

    .header .logo {
      height: 30px;
      width: auto;
    }

    .header-title {
      font-size: 18px;
      font-weight: bold;
      color: white;
      margin: 0;
    }

    /* ç¾åŒ–æ–‡ä»¶é€‰æ‹©æŒ‰é’® */
    .file-input {
      display: none;
    }

    .file-label {
      display: inline-block;
      padding: 8px 15px;
      background-color: #444;
      color: white;
      border: 1px solid #555;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .file-label:hover {
      background-color: #555;
    }

    /* è®©æ–‡ä»¶é€‰æ‹©æŒ‰é’®ä¸ label ç»‘å®š */
    .file-input:focus + .file-label {
      outline: 2px solid #545454;
      outline-offset: 2px;
    }

    /* æ»šåŠ¨æ¡ç¾åŒ– */
    .overflow-y::-webkit-scrollbar {
      width: 8px;
    }

    .overflow-y::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 4px;
    }

    .overflow-y::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    .overflow-y::-webkit-scrollbar-track {
      background: #222;
    }

  </style>
</head>
<body>

  <div class="header">
  <img src="./../static/logo.png" alt="Logo" class="logo" />
  <h1 class="header-title">Infinite Bio-Agents</h1>
  </div>

  <div class="container-fluid vh-100 d-flex">
    <!-- å·¦ä¾§å¯¹è¯é¡µé¢ -->
    <div class="chat-area border-end">
      <!-- æ¶ˆæ¯åŒºåŸŸ -->
      <div class="message-area" id="messageArea">
        <!-- å¾ªç¯æ¸²æŸ“ç”¨æˆ·ä¸AIçš„æ¶ˆæ¯ -->
        {% if messages %}
          {% for message in messages %}
            <div class="message {{ message.type }}">
              <div class="bubble">{{ message.text }}</div>
            </div>
          {% endfor %}
        {% endif %}
      </div>

      <!-- è¾“å…¥æ¡† -->
      <form action="/" method="POST" class="input-area">
        <select name="agent" class="agent-select">
          <option value="paperai" selected>Paper Chat</option>
          <option value="codeai">Code Helper</option>
        </select>
        <input
          type="text"
          class="input-box"
          id="userInput"
          name="userInput"
          placeholder="Input something here..."
          required
        />
        <button type="submit" class="send-button">Send Message</button>
      </form>
    </div>

    <!-- å³ä¾§åŠŸèƒ½åŒº -->
    <div class="function-area">
      <!-- æ–‡ä»¶ä¸Šä¼ åŒº -->
      <div class="file-area">
        <h5 class="section-title">WorkingSpace</h5>
        <!-- æ–‡ä»¶ä¸Šä¼ è¡¨å• -->
        <form id="uploadForm" action="/" method="POST" enctype="multipart/form-data">
          <label for="fileInput" class="file-label">Upload File</label>
          <input type="file" class="file-input" id="fileInput" name="file" multiple />
        </form>
        <ul class="file-list" id="fileList">
          {% if uploaded_files %}
            {% for file in uploaded_files %}
              <li>{{ file }}</li>
            {% endfor %}
          {% endif %}
        </ul>
      </div>


      <!-- è°ƒè¯•ä¿¡æ¯åŒº -->
      <div class="log-area">
        <h5 class="section-title">Logs</h5>
        <ul class="log-list">
          <!-- åŠ¨æ€æ˜¾ç¤ºæ—¥å¿— -->
          {% if logs %}
            {% for log in logs %}
              <li>{{ log }}</li>
            {% endfor %}
          {% endif %}
        </ul>
      </div>
    </div>
  </div>
  <script>
    document.getElementById("fileInput").addEventListener("change", async function (event) {
      const fileList = document.getElementById("fileList");
      const files = event.target.files;

      const formData = new FormData();
      for (const file of files) {
        formData.append("files", file);

        const listItem = document.createElement("li");
        listItem.textContent = file.name;
        fileList.appendChild(listItem);
      }

      try {
        const response = await fetch("/upload", {
          method: "POST",
          body: formData,
        });

        if (response.ok) {
          const result = await response.json();
          console.log("æ–‡ä»¶ä¸Šä¼ æˆåŠŸ:", result);

          if (result.logs) {
            result.logs.forEach((log) => {
              const logItem = document.createElement("li");
              logItem.textContent = log;
              document.querySelector(".log-list").appendChild(logItem);
            });
          }
        } else {
          console.error("æ–‡ä»¶ä¸Šä¼ å¤±è´¥", response.statusText);
        }
      } catch (error) {
        console.error("æ–‡ä»¶ä¸Šä¼ å‘ç”Ÿé”™è¯¯", error);
      }
    });
  </script>
</body>
</html>
